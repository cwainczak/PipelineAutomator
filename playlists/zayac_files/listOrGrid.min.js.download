/*! EnsembleVideo - v5.4.0 */

(function(e){(function(i){"use strict";var t=function(){try{if(i.URLSearchParams&&new i.URLSearchParams("foo=bar").get("foo")==="bar"){return i.URLSearchParams}}catch(e){}return null}(),e=t&&new t({a:1}).toString()==="a=1",r=t&&new t("s=%2B").get("s")==="+",a="__URLSearchParams__",n=t?function(){var e=new t;e.append("s"," &");return e.toString()==="s=+%26"}():true,s=o.prototype,l=!!(i.Symbol&&i.Symbol.iterator);if(t&&e&&r&&n){return}function o(e){e=e||"";if(e instanceof URLSearchParams||e instanceof o){e=e.toString()}this[a]=f(e)}s.append=function(e,t){v(this[a],e,t)};s["delete"]=function(e){delete this[a][e]};s.get=function(e){var t=this[a];return this.has(e)?t[e][0]:null};s.getAll=function(e){var t=this[a];return this.has(e)?t[e].slice(0):[]};s.has=function(e){return g(this[a],e)};s.set=function e(t,i){this[a][t]=[""+i]};s.toString=function(){var e=this[a],t=[],i,r,n,s;for(r in e){n=c(r);for(i=0,s=e[r];i<s.length;i++){t.push(n+"="+c(s[i]))}}return t.join("&")};var h=!r;var u=!h&&t&&!e&&i.Proxy;Object.defineProperty(i,"URLSearchParams",{value:u?new Proxy(t,{construct:function(e,t){return new e(new o(t[0]).toString())}}):o});var d=i.URLSearchParams.prototype;d.polyfill=true;d.forEach=d.forEach||function(i,r){var e=f(this.toString());Object.getOwnPropertyNames(e).forEach(function(t){e[t].forEach(function(e){i.call(r,e,t,this)},this)},this)};d.sort=d.sort||function(){var e=f(this.toString()),t=[],i,r,n;for(i in e){t.push(i)}t.sort();for(r=0;r<t.length;r++){this["delete"](t[r])}for(r=0;r<t.length;r++){var s=t[r],a=e[s];for(n=0;n<a.length;n++){this.append(s,a[n])}}};d.keys=d.keys||function(){var i=[];this.forEach(function(e,t){i.push(t)});return m(i)};d.values=d.values||function(){var t=[];this.forEach(function(e){t.push(e)});return m(t)};d.entries=d.entries||function(){var i=[];this.forEach(function(e,t){i.push([t,e])});return m(i)};if(l){d[i.Symbol.iterator]=d[i.Symbol.iterator]||d.entries}function c(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'\(\)~]|%20|%00/g,function(e){return t[e]})}function p(e){return e.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/gi,function(e){return decodeURIComponent(e)})}function m(t){var e={next:function(){var e=t.shift();return{done:e===undefined,value:e}}};if(l){e[i.Symbol.iterator]=function(){return e}}return e}function f(e){var t={};if(typeof e==="object"){if(y(e)){for(var i=0;i<e.length;i++){var r=e[i];if(y(r)&&r.length===2){v(t,r[0],r[1])}else{throw new TypeError("Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements")}}}else{for(var n in e){if(e.hasOwnProperty(n)){v(t,n,e[n])}}}}else{if(e.indexOf("?")===0){e=e.slice(1)}var s=e.split("&");for(var a=0;a<s.length;a++){var l=s[a],o=l.indexOf("=");if(-1<o){v(t,p(l.slice(0,o)),p(l.slice(o+1)))}else{if(l){v(t,p(l),"")}}}}return t}function v(e,t,i){var r=typeof i==="string"?i:i!==null&&i!==undefined&&typeof i.toString==="function"?i.toString():JSON.stringify(i);if(g(e,t)){e[t].push(r)}else{e[t]=[r]}}function y(e){return!!e&&"[object Array]"===Object.prototype.toString.call(e)}function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}})(typeof global!=="undefined"?global:typeof window!=="undefined"?window:this);var u=function(e){return{formatTime:function(e){if(e===0){return"00:00:00"}var t=new Date(1970,0,1);t.setSeconds(e);return t.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},insideIframe:function(){try{return window.self!==window.top}catch(e){return true}},setThumbnailParameters:function(e,t,i,r){return e.replace(/[{}]/g,"").replace("width,","width="+t).replace("height,","&height="+i).replace("bgColor","&bgColor="+r)},getIdentityRefreshInterval:function(e){var t=new URLSearchParams(e);var i=t.get("idn_expiry");if(i===undefined)return 0;var r=621355968e9;var n=i-r;var s=n/1e4;var a=new Date(s);var l=s-Date.now()-6e4;console.log("Next Expiration: "+a+", Refresh Interval: "+l);return l>0?l:0},overrideParameter:function(e,t,i){if(e===undefined||e===null||t===null||t===undefined||t==="")return e;if(e.toLowerCase().indexOf(t.toLowerCase())>-1){e=e.replace(new RegExp("("+t+"=).*?(&|$)","ig"),"$1"+i+"$2")}else{e=e.indexOf("?")>-1||e.toLowerCase().indexOf("http")===-1?e+"&"+t+"="+i:e+"?"+t+"="+i}return e},overrideIdentityParams:function(e,t){for(var i in t){var r=t[i];if(r!==undefined&&r!==null&&r!=="")e=this.overrideParameter(e,i,r)}return e},setPreviewUrl:function(e,t,i,r,n){if(i)e=this.overrideParameter(e,"autoPlay","true");e=this.overrideParameter(e,"isResponsive","true");e=this.overrideParameter(e,"displayMenu","false");e=this.setContentPreviewParameter(e,t);e=this.appendCustomQuery(e,r);e=this.appendCustomQuery(e,n);return e},setLaunchUrl:function(e,t,i,r){e=this.appendCustomQuery(e,t);e=this.appendCustomQuery(e,i);e=this.appendCustomQuery(e,r);return e},appendCustomQuery:function(e,t){if(t===undefined||t===null||t==="")return e;return e.indexOf("?")>-1?e+"&"+t:e+"?"+t},setContentPreviewParameter:function(e,t){if(t===undefined||t===null)return e;if(t.toLowerCase().indexOf("iscontentpreview=true")===-1)return e;e=e.toLowerCase().indexOf("/quiz/")===-1?this.overrideParameter(e,"isContentPreview","true"):this.overrideParameter(e,"isQuizPreview","true");return e},findByPropertyValue:function(e,t,i){return e.filter(function(e){if(e[t]===i){return e}return null})[0]},getDefaultPlaybackSource:function(e){var t=this.findByPropertyValue(e,"isDefault","true");if(t===null||t===undefined)t=e[0].filePath;return t},getStoragePreference:function(e){var t;try{t=localStorage.getItem(e.key)}catch(e){console.error(e.message)}if(!t)t=e.defaultValue;return t},getOrSetStoragePreference:function(e){var t;try{t=localStorage.getItem(e.key)}catch(e){console.error(e.message)}if(!t){t=e.defaultValue;try{localStorage.setItem(e.key,e.defaultValue)}catch(e){console.error(e.message)}}return t},setStoragePreference:function(e){localStorage.setItem(e.key,e.value)},stringToBool:function(e){return e!==undefined&&e!==null&&e!==""&&e.toLowerCase()==="true"}}}(e);define(["jquery","moment","moment-timezone"],function(s,n,e){"use strict";window.EnsembleVideo=window.EnsembleVideo||{};window.EnsembleVideo.Hal=function(e){this.rootUrl=e.rootUrl;this.setting=e.setting;this.brandingUrl=null;this.fallbackThumbnailUrl=null;this.brandingUrlPath=[{name:"ev:Brandings/Current",type:"link"},{name:"href",type:"property"}];this.nextPagePath=[{name:"next",type:"link"},{name:"href",type:"property"}];this.selfPath=[{name:"self",type:"link"},{name:"href",type:"property"}];this.playlistTitlePath=[{name:"ev:Playlists/Get",type:"embed"},{name:"title",type:"property"}];this.playlistLogoPath=[{name:"ev:Playlists/Get",type:"embed"},{name:"logo",type:"property"}];this.playlistPublishedCategoriesPath=[{name:"ev:Playlists/Get",type:"embed"},{name:"publishedCategories",type:"property"}];this.quizThumbnailPath=[{name:"ev:Quizzes/Get",type:"embed"},{name:"ev:Contents/Get",type:"embed"},{name:"ev:Images/Thumbnail",type:"link"},{name:"href",type:"property"}];this.contentThumbnailPath=[{name:"ev:Contents/Get",type:"embed"},{name:"ev:Images/Thumbnail",type:"link"},{name:"href",type:"property"}];this.quizPluginPath=[{name:"ev:Quizzes/Get",type:"embed"},{name:"ev:QuizPlugin/Get",type:"link"},{name:"href",type:"property"}];this.contentPluginPath=[{name:"ev:Contents/Get",type:"embed"},{name:"ev:Plugin/Get",type:"link"},{name:"href",type:"property"}];this.quizLaunchPath=[{name:"ev:Quizzes/Get",type:"embed"},{name:"ev:QuizPlugin/Launch",type:"link"},{name:"href",type:"property"}];this.contentLaunchPath=[{name:"ev:Contents/Get",type:"embed"},{name:"ev:Plugin/Launch",type:"link"},{name:"href",type:"property"}];this.quizJavascriptPluginPath=[{name:"ev:Quizzes/Get",type:"embed"},{name:"ev:QuizPlugin/JavaScript",type:"link"},{name:"href",type:"property"}];this.contentJavascriptPluginPath=[{name:"ev:Contents/Get",type:"embed"},{name:"ev:Plugin/JavaScript",type:"link"},{name:"href",type:"property"}];this.quizViewsCountPath=[{name:"ev:Quizzes/Get",type:"embed"},{name:"ev:Contents/Get",type:"embed"},{name:"viewsCount",type:"property"}];this.contentViewsCountPath=[{name:"ev:Contents/Get",type:"embed"},{name:"viewsCount",type:"property"}];this.contentWorkflowTypePath=[{name:"ev:Contents/Get",type:"embed"},{name:"workflowType",type:"property"}]};window.EnsembleVideo.Hal.prototype={initialize:function(t){var i=this;this.get(this.rootUrl,{},function(e){i.brandingUrl=i.parseHalObject(e,i.brandingUrlPath,"");i.getFallbackThumbnail(t)})},get:function(e,t,i,r){s.ajax({cache:false,type:"get",headers:{Accept:"application/hal+json, application/json, */*; q=0.01"},url:e,data:t,xhrFields:{withCredentials:true},success:function(e){if(i!==undefined)i(e)},error:function(e,t){if(r!==undefined)r(e,t)}})},delete:function(e,t,i){s.ajax({cache:false,type:"delete",headers:{Accept:"application/hal+json, application/json, */*; q=0.01"},url:e,success:function(e){if(t!==undefined)t(e)},error:function(e,t){if(i!==undefined)i(e,t)}})},parseHalObject:function(i,e,r){var n=null;s.each(e,function(e,t){if(n===null)n=i;if(t.type==="embed"){n=n._embedded[t.name]}if(t.type==="link"){n=n._links[t.name]}if(t.type==="property"){n=n[t.name]}if(n===null||n===undefined){n=r;return false}});return n},parsePublish:function(e){var t="";var i="";var r="0";var n="";var s="";var a=false;if(e.isQuiz){t=this.parseHalObject(e,this.quizPluginPath,"");i=this.parseHalObject(e,this.quizLaunchPath,"");n=this.parseHalObject(e,this.quizThumbnailPath,this.fallbackThumbnailUrl);s=this.parseHalObject(e,this.quizJavascriptPluginPath,"")}else{t=this.parseHalObject(e,this.contentPluginPath,"");i=this.parseHalObject(e,this.contentLaunchPath,"");r=this.parseHalObject(e,this.contentViewsCountPath,"0");n=this.parseHalObject(e,this.contentThumbnailPath,this.fallbackThumbnailUrl);s=this.parseHalObject(e,this.contentJavascriptPluginPath,"");a=this.parseHalObject(e,this.contentWorkflowTypePath,"")==="YouTube"}return{id:e.id,isQuiz:e.isQuiz,name:e.title,dateProduced:this.convertToUserDateTime(e.dateProduced,this.setting.timeZone,this.setting.dateFormat),duration:u.formatTime(e.duration),thumbnailUrl:n,viewsCount:r,pluginUrl:t,launchUrl:i,javascriptPluginUrl:s,isYoutube:a}},getFallbackThumbnail:function(t){var i=this;this.get(this.brandingUrl,{},function(e){i.fallbackThumbnailUrl=e.thumbnailImageUrlTemplate;t()})},convertToUserDateTime:function(t,e,i){try{var r=n.utc(t).tz(e).toDate();return this.formatDateTime(r,i)}catch(e){console.log(e);return t}},formatDateTime:function(e,t){return n(e).format(t)}}});(function(h){window.EnsembleVideo=window.EnsembleVideo||{};window.EnsembleVideo.ListOrGridPlugin=function(e){this.requestId=e.requestId;this.filter=e.filter;this.api=e.api;this.setting=e.setting;this.localization=e.localization;this.contentQueryString=e.contentQueryString;this.viewingContextQueryString=e.viewingContextQueryString;this.refreshIdentity=e.refreshIdentity;this.identityQueryString=e.identityQueryString;this.identityParams={};this.identityRefreshInterval=0;this.isResponsive=u.stringToBool(e.isResponsive);this.adjustHeight=u.stringToBool(e.adjustHeight);this.forceIframe=u.stringToBool(e.forceIframe);this.isPreview=u.stringToBool(e.isPreview);this.view=e.defaultView;this.hal=null;this.playlist=null;this.currentPlaybackItem=null;this.gridRow=null;this.gridCounter=0;this.lastItemIndex=0;this.loaderIdSelector="#loading_spinner_"+this.requestId;this.moreLoaderIdSelector="#loading_spinner_more_"+this.requestId;this.pluginSelector="#pl_plugin_"+this.requestId;this.pluginPlayerSelector="#pl_plugin_player_"+this.requestId;this.pluginPreviewSelector="#pl-plugin-preview_"+this.requestId;this.itemsCollectionSelector="#pl_collection_"+this.requestId;this.itemsContainerSelector="#pl_items_container_"+this.requestId;this.itemsCountSelector="#pl_items_count_"+this.requestId;this.categoriesBlockSelector="#pl_categories_block_"+this.requestId;this.categoriesSelector="#pl_categories_"+this.requestId;this.searchSelector="#pl_search_"+this.requestId;this.searchBtnSelector="#pl_search_btn_"+this.requestId;this.listViewSelector="#pl_list_view_"+this.requestId;this.gridViewSelector="#pl_grid_view_"+this.requestId;this.iframePlayerTemplateSelector="#pl_tmpl_iframe_player_"+this.requestId;this.javascriptPlayerTemplateSelector="#pl_tmpl_javascript_player_"+this.requestId;this.headerBlocksSelector=".ev-pl-header-info_"+this.requestId+", .ev-pl-header-filter_"+this.requestId;this.headerSelector=".ev-pl-header_"+this.requestId;this.emptySelector="#pl_empty_"+this.requestId;this.listItemTemplateSelector="#pl_tmpl_list_item_"+this.requestId;this.listItemImgSelector=".ev-pl-list-item-img_"+this.requestId;this.listItemDescSelector=".ev-pl-list-item-desc_"+this.requestId;this.embedContainerSelector="#"+e.embedContainerId;this.logoSelector="#pl-header-logo-"+this.requestId;this.launchSelector=".ev-pl-launch-"+this.requestId;this.closeOverlayBtnSelector="#pl_overlay_close_btn_"+this.requestId;this.previousItemBtnSelector="#pl_overlay_previous_btn_"+this.requestId;this.nextItemBtnSelector="#pl_overlay_next_btn_"+this.requestId;this.gridItemTemplateSelector="#pl_tmpl_grid_item_"+this.requestId;this.gridItemImgSelector=".ev-pl-grid-item-img_"+this.requestId;this.gridItemsSelector=".ev-pl-grid-item_"+this.requestId;this.listItemsSelector=".ev-pl-list-item_"+this.requestId;this.gridItemOverlaySelector=".ev-pl-grid-item-info-overlay-"+this.requestId;this.gridItemLaunchSelector=".ev-pl-link-launch";this.playableItemsSelector=".ev-pl-list-play_"+this.requestId+", .ev-pl-grid-play_"+this.requestId;this.loadableItemsTemplateSelector=".ev-pl-list-play_"+this.requestId+"[data-index={data-index}], .ev-pl-grid-play_"+this.requestId+"[data-index={data-index}]";this.clearItemsSelector=".ev-pl-list-item_"+this.requestId+", .ev-pl-grid-item_"+this.requestId+", .ev-pl-grid-row_"+this.requestId;this.loadMoreLoaderSelector=".ev-pl-loader_"+this.requestId;this.clickRegisteredSelector=".click-registered"+this.requestId;this.listPlayClass="ev-pl-list-play_"+this.requestId;this.gridPlayClass="ev-pl-grid-play_"+this.requestId;this.clickRegisteredClass="click-registered"+this.requestId;this.gridItemResponsiveClass="ev-pl-item-3";this.listItemImgResponsiveClass="ev-pl-item-3";this.listItemDescResponsiveClass="ev-pl-item-9";this.headerBlockResponsiveClass="ev-pl-item-6";this.headerHeight=109;this.thumbnailWidth=0;this.thumbnailHeight=0;this.viewPreferenceStorageKey="ev.preference.playlist.view"};window.EnsembleVideo.ListOrGridPlugin.prototype={initialize:function(){h(this.loaderIdSelector).css("display","table");if(!this.isPreview){this.view=u.getStoragePreference({key:this.viewPreferenceStorageKey,defaultValue:this.view})}this.hal=new window.EnsembleVideo.Hal({rootUrl:this.api.rootUrl,setting:this.setting});this.handleIdentityRefresh();var t=this;this.hal.initialize(function(){t.hal.get(t.api.playlistUrl,t.filter,function(e){t.playlist=t.parseData(e);if(t.playlist.itemsCount===0){t.renderEmptyPlaylist();return}t.handleHeaderResize();t.renderHeader();t.handlePlayerResize();t.adjustPluginHeight();t.render();t.handleInitialActions()})})},handleIdentityRefresh:function(){if(!this.refreshIdentity||this.identityQueryString===undefined||this.identityQueryString===null||this.identityQueryString==="")return;this.identityRefreshInterval=u.getIdentityRefreshInterval(this.identityQueryString);if(this.identityRefreshInterval===0)return;var t=this;setTimeout(function(){var e=u.appendCustomQuery(t.api.pluginIdentityUrl,t.identityQueryString);console.log("Refreshing Identity: "+t.identityQueryString);t.hal.get(e,{},function(e){t.identityQueryString=e.identityQuery;t.identityParams={idn_playlist:e.playlistId,idn_content:e.contentId,idn_dropbox:e.dropboxId,idn_ref:e.ref,idn_pp:e.playlistPa,idn_cp:e.contentPa,idn_dp:e.dropboxPa,idn_ua:e.ua,idn_pe:e.isPe,idn_init:e.isInit,idn_expiry:e.expiry,idn_sig:e.signature};t.handleIdentityRefresh()},function(e,t){location.reload(true)})},this.identityRefreshInterval)},parseData:function(e){if(e===null||e===undefined)return null;var i={name:this.hal.parseHalObject(e,this.hal.playlistTitlePath,""),logo:this.hal.parseHalObject(e,this.hal.playlistLogoPath,undefined),items:[],itemsCount:e.totalItemsCount,categories:this.hal.parseHalObject(e,this.hal.playlistPublishedCategoriesPath,[]),nextPageUrl:this.hal.parseHalObject(e,this.hal.nextPagePath,undefined)};var r=this;h.each(e._embedded.publishing,function(e,t){i.items.push(r.hal.parsePublish(t))});return i},parsePageData:function(e){if(e===null||e===undefined)return null;var i={items:[],nextPageUrl:this.hal.parseHalObject(e,this.hal.nextPagePath,undefined)};var r=this;h.each(e._embedded.publishing,function(e,t){i.items.push(r.hal.parsePublish(t))});return i},renderEmptyPlaylist:function(){h(this.loaderIdSelector).css("display","none");h(this.emptySelector).show()},render:function(){if(this.view==="list"){this.renderList(this.playlist.items);this.handleListResize();h(this.loaderIdSelector).css("display","none");h(this.logoSelector).show()}else{this.renderGrid(this.playlist.items);this.handleGridResize();h(this.loaderIdSelector).css("display","none");h(this.logoSelector).show();var e=h(this.itemsCollectionSelector);while(e.children().height()<e.outerHeight()&&this.hasNextPage()){this.loadMore(e)}}},renderMore:function(e){if(this.view==="list"){this.renderList(e);this.handleListResize()}else{this.renderGrid(e);this.handleGridResize()}},renderList:function(e){var a=this;h.each(e,function(e,t){var i=a.lastItemIndex+1;var r=u.appendCustomQuery(t.pluginUrl,a.contentQueryString);r=u.appendCustomQuery(r,a.identityQueryString);r=u.overrideParameter(r,a.viewingContextQueryString);r=u.overrideParameter(r,"autoPlay","true");r=u.overrideParameter(r,"displayMetaData","true");r=u.overrideParameter(r,"displayTitle","true");var n=u.appendCustomQuery(t.javascriptPluginUrl,a.contentQueryString);n=u.appendCustomQuery(n,a.identityQueryString);n=u.overrideParameter(n,a.viewingContextQueryString);n=u.overrideParameter(n,"autoPlay","true");n=u.overrideParameter(n,"displayMetaData","true");n=u.overrideParameter(n,"displayTitle","true");var s=h(a.listItemTemplateSelector).tmpl({index:i,id:t.id,isQuiz:t.isQuiz,name:t.name,duration:t.duration,pluginUrl:r,javascriptPluginUrl:n,launchUrl:u.setLaunchUrl(t.launchUrl,a.contentQueryString,a.identityQueryString,a.viewingContextQueryString),viewsCount:t.viewsCount,dateProduced:t.dateProduced,thumbnailUrl:u.setThumbnailParameters(t.thumbnailUrl,300,169,"Black"),isYoutube:t.isYoutube});h(a.itemsContainerSelector).append(s);a.lastItemIndex=i});this.handleItemsActions();this.setScrollerHeight()},renderGrid:function(e){var a=this;h.each(e,function(e,t){var i=a.lastItemIndex+1;var r=u.appendCustomQuery(t.pluginUrl,a.contentQueryString);r=u.appendCustomQuery(r,a.identityQueryString);r=u.overrideParameter(r,a.viewingContextQueryString);r=u.overrideParameter(r,"autoPlay","true");r=u.overrideParameter(r,"displayMetaData","true");r=u.overrideParameter(r,"displayTitle","true");r=u.overrideParameter(r,"displayMenu","true");var n=u.appendCustomQuery(t.javascriptPluginUrl,a.contentQueryString);n=u.appendCustomQuery(n,a.identityQueryString);n=u.overrideParameter(n,a.viewingContextQueryString);n=u.overrideParameter(n,"autoPlay","true");n=u.overrideParameter(n,"displayMetaData","true");n=u.overrideParameter(n,"displayTitle","true");n=u.overrideParameter(n,"displayMenu","true");var s=h(a.gridItemTemplateSelector).tmpl({index:i,id:t.id,isQuiz:t.isQuiz,name:t.name,duration:t.duration,pluginUrl:r,javascriptPluginUrl:n,launchUrl:u.setLaunchUrl(t.launchUrl,a.contentQueryString,a.identityQueryString,a.viewingContextQueryString),viewsCount:t.viewsCount,dateProduced:t.dateProduced,thumbnailUrl:u.setThumbnailParameters(t.thumbnailUrl,300,169,"Black"),isYoutube:t.isYoutube});h(a.itemsContainerSelector).append(s);a.lastItemIndex=i});this.handleItemsActions();this.setScrollerHeight()},renderHeader:function(){this.renderVideosCount();this.renderSearch();this.renderCategories()},renderVideosCount:function(){var e=this.playlist.itemsCount>1?this.localization.videos:this.localization.video;h(this.itemsCountSelector).text(this.playlist.itemsCount+" "+e)},renderSearch:function(){if(this.search!==null&&this.search!==undefined)h(this.searchSelector).val(this.search)},renderCategories:function(){if(this.playlist.categories.length<2)return;var r=h(this.categoriesSelector);r.empty().append(h('<option value="-1">'+this.localization.viewAll+"</option>"));h.each(this.playlist.categories,function(e,t){var i=h("<option></option>");i.attr("value",t.id).text(t.title);r.append(i)});h(this.categoriesBlockSelector).removeClass("ev-hidden")},handleInitialActions:function(){var t=this;h(this.gridViewSelector).on("click",function(){if(t.view==="grid")return;t.view="grid";if(!t.isPreview){u.setStoragePreference({key:t.viewPreferenceStorageKey,value:"grid"})}t.lastItemIndex=0;h(t.clearItemsSelector).remove();t.renderGrid(t.playlist.items);t.handleGridResize();var e=h(t.itemsCollectionSelector);while(e.children().height()-200<e.outerHeight()&&t.hasNextPage()){t.loadMore(e)}});h(this.listViewSelector).on("click",function(){if(t.view==="list")return;t.view="list";if(!t.isPreview){u.setStoragePreference({key:t.viewPreferenceStorageKey,value:"list"})}t.lastItemIndex=0;h(t.clearItemsSelector).remove();t.renderList(t.playlist.items);t.handleListResize()});h(this.searchBtnSelector).on("click",function(){h(t.clearItemsSelector).remove();t.refresh()});h(this.searchSelector).on("keyup",function(e){if(e.which===13){h(t.searchBtnSelector).click()}});h(this.categoriesSelector).on("change",function(){h(t.clearItemsSelector).remove();t.refresh()});h(this.itemsCollectionSelector).on("scroll",function(){var e=h(this);if(Math.abs(e[0].scrollHeight-e.scrollTop()-e.outerHeight())<1){t.loadMore(e)}});h(this.closeOverlayBtnSelector).on("click",function(){h(t.pluginPlayerSelector).empty();h(t.pluginPreviewSelector).hide()});h(this.previousItemBtnSelector).on("click",function(){t.loadPreviousPlayerItem()});h(this.nextItemBtnSelector).on("click",function(){t.loadNextPlayerItem()});if(this.isResponsive){h(window).on("resize",function(){t.handleGridResize();t.handleListResize();t.handlePlayerResize();t.handleHeaderResize();t.setScrollerHeight();t.adjustPluginHeight()})}},handleGridResize:function(){if(this.view!=="grid")return;var e=h(this.gridItemsSelector);var t=this.gridItemResponsiveClass;this.setGridResponsiveClass();e.removeClass(t).addClass(this.gridItemResponsiveClass);e.find(this.gridItemImgSelector).css("width",this.thumbnailWidth+"px").css("height",this.thumbnailHeight+"px");e.css("height",this.thumbnailHeight+"px")},handleListResize:function(){if(this.view!=="list")return;var e=h(this.listItemsSelector);var t=this.listItemImgResponsiveClass;var i=this.listItemDescResponsiveClass;this.setListResponsiveClass();e.find(this.listItemImgSelector).removeClass(t).addClass(this.listItemImgResponsiveClass).css("width",this.thumbnailWidth+"px").css("height",this.thumbnailHeight+"px");e.find(this.listItemDescSelector).removeClass(i).addClass(this.listItemDescResponsiveClass)},handleHeaderResize:function(){var e=h(this.headerBlocksSelector);var t=this.headerBlockResponsiveClass;this.setHeaderResponsiveClass();e.removeClass(t).addClass(this.headerBlockResponsiveClass);h(this.headerSelector).css("display","block")},handlePlayerResize:function(){var e=h(this.pluginSelector);var t=h(this.pluginPlayerSelector);var i=e.width()*.5625+40;t.css("height",i+"px")},adjustPluginHeight:function(){if(!this.adjustHeight)return;var e=h(this.pluginSelector).width();var t=0;if(e>=400){t=e*.5625+140}else{t=e*.5625+390}h(this.embedContainerSelector).css("height",t+10+"px")},handleItemsActions:function(){var e=h(this.playableItemsSelector).not(this.clickRegisteredSelector);var t=e.parent().parent();var r=this;e.on("click",function(e){e.preventDefault();r.currentPlaybackItem=h(this);r.loadPlayer(r.currentPlaybackItem)});t.find(r.launchSelector).on("click",function(e){e.preventDefault();var t=u.overrideIdentityParams(h(this).attr("href"),r.identityParams);window.open(t,"_blank")});e.find("img").on("error",function(e){var t=u.setThumbnailParameters(r.hal.fallbackThumbnailUrl,300,169,"Black");var i=h(this);if(i.attr("src")!==t){i.attr("src",t);i.off("error")}});e.on("focus",function(e){var i=h(this);h(window).keyup(function(e){var t=e.keyCode?e.keyCode:e.which;if(t===9&&i.is(":focus")){i.parent().parent().find(r.gridItemOverlaySelector).addClass("focus")}})});t.find(this.gridItemLaunchSelector).on("focus",function(e){h(this).parent().parent().parent().addClass("focus")});t.find(this.gridItemLaunchSelector).on("blur",function(e){h(this).parent().parent().parent().removeClass("focus")});e.addClass(r.clickRegisteredClass)},loadMore:function(i){if(!this.hasNextPage())return;var e=this.playlist.nextPageUrl;e=u.appendCustomQuery(e,this.identityQueryString);this.playlist.nextPageUrl=null;var r=h(this.loaderIdSelector).is(":visible");if(!r)h(i).find(this.loadMoreLoaderSelector).show();var n=this;n.hal.get(e,{},function(e){var t=n.parsePageData(e);n.playlist.nextPageUrl=t.nextPageUrl;h.each(t.items,function(e,t){n.playlist.items.push(t)});n.renderMore(t.items);if(!r)h(i).find(n.loadMoreLoaderSelector).hide()})},refresh:function(){this.filter.search=h(this.searchSelector).val();this.filter.categories=h(this.categoriesSelector).val()==="-1"?undefined:h(this.categoriesSelector).val();this.gridCounter=0;this.lastItemIndex=0;var e=h(this.itemsCollectionSelector);e.find(this.clearItemsSelector).remove();e.css("height","initial");h(this.loaderIdSelector).css("display","table");var t=this;var i=u.overrideIdentityParams(t.api.playlistUrl,t.identityParams);t.hal.get(i,t.filter,function(e){t.playlist=t.parseData(e);t.renderVideosCount();t.render()})},loadPlayer:function(e){var t=e.attr("data-name");var i="";if(u.insideIframe()||this.forceIframe||e.isYoutube){var r=e.attr("data-plugin-url");i=h(this.iframePlayerTemplateSelector).tmpl({name:t,pluginUrl:u.overrideIdentityParams(r,this.identityParams)})}else{var n=e.attr("data-id");var s="embed_"+this.requestId+"_"+n;var a=u.overrideParameter(e.attr("data-plugin-javascript-url"),"embedId",s);a=u.overrideIdentityParams(a,this.identityParams);var l='<script type="text/javascript" src="'+a+'"><\/script>';i=h(this.javascriptPlayerTemplateSelector).tmpl({id:n,name:t,embedId:s,innerScript:l})}h(this.pluginPlayerSelector).html(i.html());h(this.previousItemBtnSelector).removeClass("disabled").removeAttr("disabled");h(this.nextItemBtnSelector).removeClass("disabled").removeAttr("disabled");if(e.attr("data-index")==="1"){h(this.previousItemBtnSelector).addClass("disabled").attr("disabled","disabled")}if(e.attr("data-index")===this.playlist.itemsCount.toString()){h(this.nextItemBtnSelector).addClass("disabled").attr("disabled","disabled")}var o=h(this.pluginPreviewSelector);if(!o.is(":visible")){o.show();o.find(this.closeOverlayBtnSelector).focus()}},loadNextPlayerItem:function(){var e=parseInt(this.currentPlaybackItem.attr("data-index"));this.currentPlaybackItem=h(this.loadableItemsTemplateSelector.replace(/{data-index}/g,e+1));this.loadPlayer(this.currentPlaybackItem)},loadPreviousPlayerItem:function(){var e=parseInt(this.currentPlaybackItem.attr("data-index"));this.currentPlaybackItem=h(this.loadableItemsTemplateSelector.replace(/{data-index}/g,e-1));this.loadPlayer(this.currentPlaybackItem)},setGridResponsiveClass:function(){var e=h(this.itemsContainerSelector).width();if(e>=800){this.gridItemResponsiveClass="ev-pl-item-3";this.thumbnailWidth=e*25/100-30;this.thumbnailHeight=this.thumbnailWidth*.5625;return}if(e>=650){this.gridItemResponsiveClass="ev-pl-item-4";this.thumbnailWidth=e*33.3/100-30;this.thumbnailHeight=this.thumbnailWidth*.5625;return}if(e>=400){this.gridItemResponsiveClass="ev-pl-item-6";this.thumbnailWidth=e*50/100-30;this.thumbnailHeight=this.thumbnailWidth*.5625;return}this.gridItemResponsiveClass="ev-pl-item-12";this.thumbnailWidth=e-30;this.thumbnailHeight=this.thumbnailWidth*.5625},setListResponsiveClass:function(){var e=h(this.itemsContainerSelector).width();if(e>=300){this.listItemImgResponsiveClass="ev-pl-item-3";this.listItemDescResponsiveClass="ev-pl-item-9";this.thumbnailWidth=e*25/100;this.thumbnailHeight=this.thumbnailWidth*.5625;return}this.listItemImgResponsiveClass="ev-pl-item-12";this.listItemDescResponsiveClass="ev-pl-item-12";this.thumbnailWidth=e;this.thumbnailHeight=this.thumbnailWidth*.5625},setHeaderResponsiveClass:function(){var e=h(this.itemsContainerSelector).width();if(e>=500){this.headerBlockResponsiveClass="ev-pl-item-6";return}this.headerBlockResponsiveClass="ev-pl-item-12"},setScrollerHeight:function(){this.headerHeight=h(this.headerSelector).height()+26;h(this.itemsCollectionSelector).css("height","calc(100% - "+this.headerHeight+"px)")},hasNextPage:function(){return this.playlist.nextPageUrl!==undefined&&this.playlist.nextPageUrl!==null&&this.playlist.nextPageUrl!==""}}})(e)})($ev);
//# sourceMappingURL=listOrGrid.min.js.map